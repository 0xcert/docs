<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Atomic actions | 0xcert Framework v2.0 - beta</title>
    <meta name="description" content="Leverage the most advanced open-source framework to create, manage and swap digital assets (ERC-721) and value tokens (ERC-20) on the blockchain.">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.da95f995.css" as="style"><link rel="preload" href="/assets/js/app.f6c584b2.js" as="script"><link rel="preload" href="/assets/js/2.f20c3283.js" as="script"><link rel="preload" href="/assets/js/7.75831217.js" as="script"><link rel="preload" href="/assets/js/17.ca0e3fbc.js" as="script"><link rel="preload" href="/assets/js/5.8bbd2355.js" as="script"><link rel="prefetch" href="/assets/js/10.03c3773a.js"><link rel="prefetch" href="/assets/js/11.ded165b2.js"><link rel="prefetch" href="/assets/js/12.3552db5e.js"><link rel="prefetch" href="/assets/js/13.b5257690.js"><link rel="prefetch" href="/assets/js/14.af0ecaf3.js"><link rel="prefetch" href="/assets/js/15.a977a377.js"><link rel="prefetch" href="/assets/js/16.d47194af.js"><link rel="prefetch" href="/assets/js/18.976311a7.js"><link rel="prefetch" href="/assets/js/19.55e8121b.js"><link rel="prefetch" href="/assets/js/20.634eaf34.js"><link rel="prefetch" href="/assets/js/21.592baaa6.js"><link rel="prefetch" href="/assets/js/22.242f2c10.js"><link rel="prefetch" href="/assets/js/23.ef79e661.js"><link rel="prefetch" href="/assets/js/24.bce06c48.js"><link rel="prefetch" href="/assets/js/25.0842674a.js"><link rel="prefetch" href="/assets/js/26.ca986deb.js"><link rel="prefetch" href="/assets/js/27.77eac601.js"><link rel="prefetch" href="/assets/js/28.31b3e84a.js"><link rel="prefetch" href="/assets/js/29.2008f371.js"><link rel="prefetch" href="/assets/js/3.e085c15b.js"><link rel="prefetch" href="/assets/js/30.2dc44648.js"><link rel="prefetch" href="/assets/js/31.462d57ea.js"><link rel="prefetch" href="/assets/js/32.c009a518.js"><link rel="prefetch" href="/assets/js/33.ac729c23.js"><link rel="prefetch" href="/assets/js/34.b44bc98e.js"><link rel="prefetch" href="/assets/js/4.cbce8c58.js"><link rel="prefetch" href="/assets/js/6.cd9bf40f.js"><link rel="prefetch" href="/assets/js/8.9091d9b3.js"><link rel="prefetch" href="/assets/js/9.b9dedc79.js">
    <link rel="stylesheet" href="/assets/css/0.styles.da95f995.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/0xcert-logo.svg" alt="0xcert Framework v2.0 - beta" class="logo"> <span class="site-name can-hide">0xcert Framework v2.0 - beta</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://v1.docs.0xcert.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.0
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://0xcert.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  0xcert Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/0xcert/framework" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://v1.docs.0xcert.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.0
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://0xcert.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  0xcert Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/0xcert/framework" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction/overview.html" class="sidebar-link">Overview</a></li><li><a href="/introduction/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/introduction/non-fungible-assets.html" class="sidebar-link">Non-fungible assets</a></li><li><a href="/introduction/fungible-values.html" class="sidebar-link">Fungible values</a></li><li><a href="/introduction/0xcert-tokens.html" class="sidebar-link">0xcert tokens</a></li><li><a href="/introduction/atomic-transactions.html" class="sidebar-link">Atomic transactions</a></li><li><a href="/introduction/interoperability.html" class="sidebar-link">Interoperability</a></li><li><a href="/introduction/authenticity.html" class="sidebar-link">Authenticity</a></li><li><a href="/introduction/threat-models.html" class="sidebar-link">Threat models</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guides</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guides/certification.html" class="sidebar-link">Certification</a></li><li><a href="/guides/communication.html" class="sidebar-link">Communication</a></li><li><a href="/guides/providers.html" class="sidebar-link">Providers</a></li><li><a href="/guides/asset-management.html" class="sidebar-link">Asset management</a></li><li><a href="/guides/value-management.html" class="sidebar-link">Value management</a></li><li><a href="/guides/atomic-deployments.html" class="sidebar-link">Atomic deployments</a></li><li><a href="/guides/atomic-actions.html" class="active sidebar-link">Atomic actions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guides/atomic-actions.html#gateway" class="sidebar-link">Gateway</a></li><li class="sidebar-sub-header"><a href="/guides/atomic-actions.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/guides/atomic-actions.html#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/guides/atomic-actions.html#initialization" class="sidebar-link">Initialization</a></li><li class="sidebar-sub-header"><a href="/guides/atomic-actions.html#fixed-actions-order" class="sidebar-link">Fixed actions order</a></li><li class="sidebar-sub-header"><a href="/guides/atomic-actions.html#signed-fixed-actions-order" class="sidebar-link">Signed fixed actions order</a></li><li class="sidebar-sub-header"><a href="/guides/atomic-actions.html#dynamic-actions-order" class="sidebar-link">Dynamic actions order</a></li><li class="sidebar-sub-header"><a href="/guides/atomic-actions.html#signed-dynamic-actions-order" class="sidebar-link">Signed dynamic actions order</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API References</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/certification.html" class="sidebar-link">Certification</a></li><li><a href="/api/0xcertapi-rest.html" class="sidebar-link">0xcertAPI REST</a></li><li><a href="/api/0xcertapi-client.html" class="sidebar-link">0xcertAPI Client</a></li><li><a href="/api/ethereum-connectors.html" class="sidebar-link">Ethereum connectors</a></li><li><a href="/api/wanchain-connectors.html" class="sidebar-link">Wanchain connectors</a></li><li><a href="/api/vuejs-plugin.html" class="sidebar-link">Vue.js Plugin</a></li></ul></section></li></ul>  <div class="footer"><img src="/0xcert-framework.svg" alt> <p>The 0xcert Framework is a platform that provides a complete set of tools for building powerful decentralized applications (dapps). <br>Feel free to <a href="https://github.com/0xcert/framework/blob/master/CONTRIBUTING.md" target="_blank">contribute.</a></p></div></aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="atomic-actions"><a href="#atomic-actions" class="header-anchor">#</a> Atomic actions</h1> <p>If you want to exchange assets with someone in a trustless way, not depending on a third party nor accepting counterparty risk, atomic actions are the way to go.</p> <p>Atomic order is a way of creating an <a href="https://0xcert.org/news/dex-series-7-atomic-swaps/" target="_self" rel="noopener noreferrer alternate">atomic swap</a> within the 0xcert Framework. It is a set of instructions for what you will execute in a single mutation and with only two possible results: either the mutation will succeed with all actions executed, or the mutation will fail and nothing will change. Atomic order leaves no middle way.</p> <p>Atomic actions can be performed between multiple parties and can contain multiple actions.</p> <p>List of available actions:</p> <ul><li>Transfer asset</li> <li>Transfer value</li> <li>Create new asset</li> <li>Update existing asset imprint</li> <li>Destroy an asset</li> <li>Update account abilities</li></ul> <p>Since atomic actions can be performed between multiple parties, there are four different ways of how to interact with them. In this guide, we will go through all of them and explain each and every one. Here is a quick overview:</p> <ul><li><code>FixedActionsOrder</code> - All participants are known and set in the order. Only the last defined participant can perform the order; others have to provide signatures.</li> <li><code>SignedFixedActionsOrder</code> - All participants are known and set in the order. All participants have to provide signatures. Anyone can perform the order.</li> <li><code>DynamicActionsOrder</code> - The last participant can be unknown or &quot;any&quot;. All defined participants have to provide signatures, anyone can perform the order. The one that performs the order, automatically becomes the last participant.</li> <li><code>SignedDynamicActionsOrder</code> - The last participant can be unknown or &quot;any&quot;. All defined participants have to provide signatures, as well as the last &quot;any&quot; participant. Anyone can then perform the order once all the signatures have been provided.</li></ul> <div class="card custom-block"><p class="custom-block-title">More about atomic swaps</p> <p>For more information on the actual process of atomic operation, please check <a href="https://0xcert.org/news/dex-series-7-atomic-swaps/" target="_self" rel="noopener noreferrer alternate">this article</a>.</p></div> <h2 id="gateway"><a href="#gateway" class="header-anchor">#</a> Gateway</h2> <p>All atomic actions within the 0xcert Framework are performed through a <code>Gateway</code>. Gateway is, as the name suggests, the gateway to multiple smart contracts that already live (and are maintained by 0xcert) on the blockchain and that enable atomic swaps with a broad array of functionalities. Depending on what kind of atomic order we are performing, there are multiple main smart contracts, as well as multiple proxies that take care of specific actions. <a href="">Here</a>, you can see all the already deployed smart contracts and their addresses.</p> <p>Since <code>Gateway</code> is a single point of entry for all kinds of atomic actions, each order is defined through an <code>Order</code> interface and has a unique <code>OrderKind</code> for the sake of differentiation.</p> <p>For the beginning of this guide, we will create a <code>FixedActionsOrder</code>, the simplest type of atomic actions.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <p>In this guide, we will assume you have gone through the <a href="">Asset Management</a> guide and have deployed an <code>AssetLedger</code>, as well created an asset with ID <code>100</code>. You will also need three MetaMask accounts (create them through your MetaMask plug-in) with some ETH available.</p> <h2 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h2> <p>We recommend you employ the package as an NPM package in your application.</p> <div class="language-ell extra-class"><pre class="language-text"><code>$ npm i --save @0xcert/ethereum-gateway
</code></pre></div><p>In our official <a href="https://github.com/0xcert/framework" target="_self" rel="noopener noreferrer alternate">GitHub repository</a>, we also host a compiled and minimized JavaScript file that can be directly implemented in your website. Please refer to the <a href="/api/core.html">API</a> section to learn more about gateway.</p> <h2 id="initialization"><a href="#initialization" class="header-anchor">#</a> Initialization</h2> <p>As usual, we first import a module into the application. This time, we import the <code>Gateway</code> class, which represents a wrapper around a specific pre-deployed structure on the Ethereum network.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Gateway <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@0xcert/ethereum-gateway'</span><span class="token punctuation">;</span>
</code></pre></div><p>Then, we create a new instance of the <code>Gateway</code> class with an ID that points to a pre-deployed gateway on the Ethereum Ropsten network (this option can also be configured in the provider).</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> gateway <span class="token operator">=</span> Gateway<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>provider<span class="token punctuation">,</span> <span class="token function">getGatewayConfig</span><span class="token punctuation">(</span>NetworkKind<span class="token punctuation">.</span><span class="token constant">ROPSTEN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>getGatewayConfig</code> will always return the latest contract versions for a specific package version. You can also configure gateway config on your own with our already deployed addresses <a href="">here</a> or with your own addresses.</p> <h2 id="fixed-actions-order"><a href="#fixed-actions-order" class="header-anchor">#</a> Fixed actions order</h2> <div class="card custom-block"><p class="custom-block-title">Live example</p> <p>Click <a href="https://codesandbox.io/s/github/0xcert/example-fixed-actions-order?module=%2FREADME.md" target="_self" rel="noopener noreferrer alternate">here</a> to check the live example for the fixed actions order.</p></div> <p>We will have two participants; one will be the account we used for creating the <code>AssetLedger</code>; the other will be the second account from MetaMask. For simplicity, let's name them account1 and account2.</p> <p>We will create a fixed actions order with two actions. The first action will be a transfer of our already created asset with ID <code>100</code> from account1 to account2. In the second action, we will create a new asset with ID <code>101</code> in account2.</p> <p>First, we start by defining the order.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> OrderKind<span class="token punctuation">.</span><span class="token constant">FIXED_ACTIONS_ORDER</span><span class="token punctuation">,</span> <span class="token comment">// defining order kind</span>
  signers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'0x...'</span><span class="token punctuation">,</span> <span class="token string">'0x...'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// account1, account2</span>
  seed<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// unique order identification</span>
  expiration<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">86400000</span><span class="token punctuation">,</span> <span class="token comment">// 1 day</span>
  actions<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// actions we want to perform in this order</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> ActionsOrderActionKind<span class="token punctuation">.</span><span class="token constant">TRANSFER_ASSET</span><span class="token punctuation">,</span> <span class="token comment">// transfer asset action</span>
      ledgerId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// assetLedgerId that we created in the previous guide</span>
      senderId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
      receiverId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account2</span>
      assetId<span class="token operator">:</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token comment">// asset id</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> ActionsOrderActionKind<span class="token punctuation">.</span><span class="token constant">CREATE_ASSET</span><span class="token punctuation">,</span>
      ledgerId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// assetLedgerId that we created in the previous guide</span>
      senderId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
      receiverId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account2</span>
      assetId<span class="token operator">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token comment">// asset id</span>
      assetImprint<span class="token operator">:</span> <span class="token string">'c6c14772f269bed1161d4350403f4c867c749b3cce7abe84c6d0605068cd8a87'</span><span class="token punctuation">,</span> <span class="token comment">// asset imprint</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> FixedActionsOrder
</code></pre></div><p>In this order, we are creating a new asset and transferring an existing one. But these actions first require our approval. So we will first approve asset transfer. For this, we will make an instance of <code>AssetLedger</code> as we learned in the <a href="">Asset Management guide</a> and set gateway proxy as an operator.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> transferProxy <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">getProxyAccountId</span><span class="token punctuation">(</span>ProxyKind<span class="token punctuation">.</span><span class="token constant">TRANSFER_ASSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mutation <span class="token operator">=</span> <span class="token keyword">await</span> assetLedger<span class="token punctuation">.</span><span class="token function">approveOperator</span><span class="token punctuation">(</span>transferProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> mutation<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Then, we will grant permission to create proxy to create a new asset on our behalf.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> createProxy <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">getProxyAccountId</span><span class="token punctuation">(</span>ProxyKind<span class="token punctuation">.</span><span class="token constant">CREATE_ASSET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mutation <span class="token operator">=</span> <span class="token keyword">await</span> assetLedger<span class="token punctuation">.</span><span class="token function">grantAbilities</span><span class="token punctuation">(</span>createProxy<span class="token punctuation">,</span> <span class="token punctuation">[</span>GeneralAssetLedgerAbility<span class="token punctuation">.</span><span class="token constant">CREATE_ASSET</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> mutation<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Don't forget to create an instance of <code>assetLedger</code> and to import <code>GeneralAssetLedgerAbility</code>.</p></div> <p>Granting permissions and setting the operator is only needed the first time (per ledger).</p> <p>Now, since we have two participants (<code>signers</code>), the first one has to sign the order while the second one can perform it. This means you have to select account1 in MetaMask when signing the order.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> signature <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>The first participant can now send their signature and the order definition to the second participant through arbitrary channels.
Once the second participant (account2) receives this data, they can perform the order.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> mutation <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> <span class="token punctuation">[</span>signature<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> mutation<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If we did everything correctly, the atomic swap would perform successfully; otherwise, an error will be thrown, specifying what went wrong.</p> <h2 id="signed-fixed-actions-order"><a href="#signed-fixed-actions-order" class="header-anchor">#</a> Signed fixed actions order</h2> <div class="card custom-block"><p class="custom-block-title">Live example</p> <p>Click <a href="https://codesandbox.io/s/github/0xcert/example-signed-fixed-actions-order?module=%2FREADME.md" target="_self" rel="noopener noreferrer alternate">here</a> to check the live example for signed fixed actions order.</p></div> <p>Just like in the fixed actions order, we will have two participants. Also, we will create an asset with ID <code>101</code> and transfer an existing asset with ID <code>100</code>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you already transferred and created an asset in the previous section on this specific <code>AssetLedger</code>, you will not be able to do the same action again since account1 is no longer the owner of the asset <code>100</code> and the asset <code>101</code> has already been created. You can either deploy a new <code>AssetLedger</code> and recreate the same starting conditions or send the asset <code>100</code> back to account1, and instead of creating the asset <code>101</code>, you can create an asset with ID <code>102</code>.</p></div> <p>The order will be defined almost the same way as in the fixed order, however, the execution process will be different. We will only showcase the differences between the fixed action order and the signed fixed action order.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> OrderKind<span class="token punctuation">.</span><span class="token constant">SIGNED_FIXED_ACTIONS_ORDER</span><span class="token punctuation">,</span> <span class="token comment">// defining order kind</span>
  signers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'0x...'</span><span class="token punctuation">,</span> <span class="token string">'0x...'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// account1, account2</span>
  seed<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// unique order identification</span>
  expiration<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">86400000</span><span class="token punctuation">,</span> <span class="token comment">// 1 day</span>
  actions<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// actions we want to perform in this order</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> ActionsOrderActionKind<span class="token punctuation">.</span><span class="token constant">TRANSFER_ASSET</span><span class="token punctuation">,</span> <span class="token comment">// transfer asset action</span>
      ledgerId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// assetLedgerId that we created in the previous guide</span>
      senderId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
      receiverId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account2</span>
      assetId<span class="token operator">:</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token comment">// asset id</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> ActionsOrderActionKind<span class="token punctuation">.</span><span class="token constant">CREATE_ASSET</span><span class="token punctuation">,</span>
      ledgerId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// assetLedgerId that we created in the previous guide</span>
      senderId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
      receiverId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account2</span>
      assetId<span class="token operator">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token comment">// asset id</span>
      assetImprint<span class="token operator">:</span> <span class="token string">'c6c14772f269bed1161d4350403f4c867c749b3cce7abe84c6d0605068cd8a87'</span><span class="token punctuation">,</span> <span class="token comment">// asset imprint</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> SignedFixedActionsOrder
</code></pre></div><p>The way we grant permissions remains the same as in the guide above.</p> <p>The difference now comes in signing the order. In the case above, only the first participant was needed to sign the order, and the second one could execute it. In this case, however, both participants need to sign the order, and any participant can execute the order.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> signatureFromAccount1 <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sign with account1 in metamask</span>
<span class="token keyword">const</span> signatureFromAccount2 <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sign with account2 in metamask</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you are not using <code>MetamaskProvider</code> where you only need to change the account in the MetaMask extension, you will need to create two providers with different default accounts, as well as two gateways, each with a different provider for signatures to be made from different accounts.</p></div> <p>Now anyone that has both signatures can execute this order:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> mutation <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> <span class="token punctuation">[</span>signatureFromAccount1<span class="token punctuation">,</span> signatureFromAccount2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// perform with account3 in metamask</span>
<span class="token keyword">await</span> mutation<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="dynamic-actions-order"><a href="#dynamic-actions-order" class="header-anchor">#</a> Dynamic actions order</h2> <div class="card custom-block"><p class="custom-block-title">Live example</p> <p>Click <a href="https://codesandbox.io/s/github/0xcert/example-dynamic-actions-order?module=%2FREADME.md" target="_self" rel="noopener noreferrer alternate">here</a> to check the live example for dynamic actions order.</p></div> <p>The difference between the fixed and the dynamic actions order is in knowing the participants beforehand. In the fixed order at defining the order, we had to specify both participants, as well as the senderId and receiverId in both actions. On the other hand, dynamic orders allow for an undefined participant. This means that anyone can become that last participant and automatically become either the <code>senderId</code> or <code>receiverId</code> in actions if they are <code>undefined</code>. This allows us to make a marketplace-like order where, for example, you can say you are selling an asset to anyone willing to pay some value for it.</p> <p>For this guide, however, we will be using the same scenario as in previous guides.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you already transferred and created an asset in the previous section on this specific <code>AssetLedger</code>, you will not be able to do the same action again since account1 is no longer the owner of the asset <code>100</code> and the asset <code>101</code> has already been created. You can either deploy a new <code>AssetLedger</code> and recreate the same starting conditions or send the asset <code>100</code> back to account1, and instead of creating the asset <code>101</code>, you can create an asset with ID <code>102</code>.</p></div> <p>Now let's define the order. Unlike the fixed order, we will define only one signer and will not define <code>receiverId</code> in actions.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> OrderKind<span class="token punctuation">.</span><span class="token constant">DYNAMIC_ACTIONS_ORDER</span><span class="token punctuation">,</span> <span class="token comment">// defining order kind</span>
  signers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'0x...'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
  seed<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// unique order identification</span>
  expiration<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">86400000</span><span class="token punctuation">,</span> <span class="token comment">// 1 day</span>
  actions<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// actions we want to perform in this order</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> ActionsOrderActionKind<span class="token punctuation">.</span><span class="token constant">TRANSFER_ASSET</span><span class="token punctuation">,</span> <span class="token comment">// transfer asset action</span>
      ledgerId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// assetLedgerId that we created in the previous guide</span>
      senderId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
      assetId<span class="token operator">:</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token comment">// asset id</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> ActionsOrderActionKind<span class="token punctuation">.</span><span class="token constant">CREATE_ASSET</span><span class="token punctuation">,</span>
      ledgerId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// assetLedgerId that we created in the previous guide</span>
      senderId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
      assetId<span class="token operator">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token comment">// asset id</span>
      assetImprint<span class="token operator">:</span> <span class="token string">'c6c14772f269bed1161d4350403f4c867c749b3cce7abe84c6d0605068cd8a87'</span><span class="token punctuation">,</span> <span class="token comment">// asset imprint</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> DynamicActionsOrder
</code></pre></div><p>We still need to grant permission the same way as in previous guides, and the specified signer needs to sign the order.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> signature <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>Now, anyone that has the order definition and the order signature from account1 can perform the order and will automatically become the last participant and receiver of both assets.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> mutation <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> <span class="token punctuation">[</span>signature<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> mutation<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="signed-dynamic-actions-order"><a href="#signed-dynamic-actions-order" class="header-anchor">#</a> Signed dynamic actions order</h2> <p>Much like a signed fixed order differs from a fixed order, the signed dynamic order differs from a dynamic order.
This means that instead of any participant being able to perform the order and become the receiver, any participant can provide the last signature, and anyone with both signatures can execute the order.</p> <p>So let's define the order.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> OrderKind<span class="token punctuation">.</span><span class="token constant">SIGNED_DYNAMIC_ACTIONS_ORDER</span><span class="token punctuation">,</span> <span class="token comment">// defining order kind</span>
  signers<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'0x...'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
  seed<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// unique order identification</span>
  expiration<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">86400000</span><span class="token punctuation">,</span> <span class="token comment">// 1 day</span>
  actions<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// actions we want to perform in this order</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> ActionsOrderActionKind<span class="token punctuation">.</span><span class="token constant">TRANSFER_ASSET</span><span class="token punctuation">,</span> <span class="token comment">// transfer asset action</span>
      ledgerId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// assetLedgerId that we created in the previous guide</span>
      senderId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
      assetId<span class="token operator">:</span> <span class="token string">'100'</span><span class="token punctuation">,</span> <span class="token comment">// asset id</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      kind<span class="token operator">:</span> ActionsOrderActionKind<span class="token punctuation">.</span><span class="token constant">CREATE_ASSET</span><span class="token punctuation">,</span>
      ledgerId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// assetLedgerId that we created in the previous guide</span>
      senderId<span class="token operator">:</span> <span class="token string">'0x..'</span><span class="token punctuation">,</span> <span class="token comment">// account1</span>
      assetId<span class="token operator">:</span> <span class="token string">'101'</span><span class="token punctuation">,</span> <span class="token comment">// asset id</span>
      assetImprint<span class="token operator">:</span> <span class="token string">'c6c14772f269bed1161d4350403f4c867c749b3cce7abe84c6d0605068cd8a87'</span><span class="token punctuation">,</span> <span class="token comment">// asset imprint</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> SignedDynamicActionsOrder
</code></pre></div><p>The way we grant permissions remains the same as in the guide above.</p> <p>The difference now comes in signing the order. In the case above, only the first participant was needed to sign the order, and any participant could execute it (making them the recipient). In this case, however, both participants need to sign the order, and any participant can execute the order.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> signatureFromAccount1 <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> signatureFromAnyone <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you are not using <code>MetamaskProvider</code> where you only need to change the account in the MetaMask extension, you will need to create two providers with different default accounts, as well as two gateways, each with a different provider for signatures to be made from different accounts.</p></div> <p>Now, anyone that has both signatures can execute this order, and the participant with the address that created the second signature will become the receiver.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> mutation <span class="token operator">=</span> <span class="token keyword">await</span> gateway<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> <span class="token punctuation">[</span>signatureFromAccount1<span class="token punctuation">,</span> signatureFromAnyone<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> mutation<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/0xcert/framework/edit/master/docs/guides/atomic-actions.md" target="_blank" rel="noopener noreferrer">Help us improve this page.</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/20/2020, 6:28:05 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guides/atomic-deployments.html" class="prev">Atomic deployments</a></span> <span class="next"><a href="/api/certification.html">Certification</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f6c584b2.js" defer></script><script src="/assets/js/2.f20c3283.js" defer></script><script src="/assets/js/7.75831217.js" defer></script><script src="/assets/js/17.ca0e3fbc.js" defer></script><script src="/assets/js/5.8bbd2355.js" defer></script>
  </body>
</html>
